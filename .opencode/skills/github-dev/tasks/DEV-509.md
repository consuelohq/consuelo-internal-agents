# DEV-509: [FEATURE]: Deploy NocoDB workspace system with SQLite and Tailscale

## Metadata
- **Identifier:** DEV-509
- **Priority:** High
- **State:** Open
- **Assignee:** kokayi
- **Creator:** kokayi
- **Labels:** kiro, spec
- **Project:** suelo
- **Created:** 2026-02-08
- **Updated:** 2026-02-08
- **URL:** https://linear.app/consuelo/issue/DEV-509/feature-deploy-nocodb-workspace-system-with-sqlite-and-tailscale
- **Linear ID:** d69d5d00-f955-46c9-b2c5-47edd8270096

## Description

## Overview

**Problem Statement:** Currently Ko and I work primarily through Slack with fragmented context. Ko can see what I am working on but cannot reference our shared state in a structured way. There is no single source of truth for projects, research, cron jobs, and decisions that we both can access - me programmatically, Ko visually.

**Why This Matters:** This will replace Slack as our primary workspace. It enables seamless handoff - Ko can say "break down the competitive analysis from yesterday" and I can retrieve it from database while Ko sees the same view. Critical for scaling our collaboration beyond ephemeral chat.

**Current State:**

* Fragmented memory files ([MEMORY.md](<http://MEMORY.md>), memory/YYYY-MM-DD.md, [decisions.md](<http://decisions.md>), etc.)
* No database-backed shared workspace
* I can only access data via file reads and web_search
* No structured tables for cron jobs, research projects, decisions

**Desired State:** A unified workspace with:

* NocoDB instance accessible via Tailscale
* SQLite database with structured tables (research, cron_jobs, projects, decisions, dashboards)
* NocoDB's built-in web UI for Ko to view and manage data
* REST API for me to write and query
* Views and dashboards created using NocoDB's native interface
* Light enough to run on Mac mini or small VPS

---

## Requirements

### Requirement 1: NocoDB Deployment

**User Story:** As a system, I need NocoDB running on a Tailscale-accessible server, so that both Ko and I can access it from anywhere.

#### Acceptance Criteria

1. THE System SHALL deploy NocoDB using Docker on a new Tailscale server
2. THE System SHALL use SQLite as the underlying database (nocoDB supports sqlite out of the box)
3. THE System SHALL expose NocoDB on a Tailscale IP/domain
4. THE System SHALL configure NocoDB with proper data persistence (volume mount for SQLite file)
5. THE System SHALL set up NocoDB admin account with strong password
6. THE System SHALL generate API token for programmatic access
7. THE System SHALL have <2GB memory footprint when idle
8. THE System SHALL auto-start on boot (docker restart policy)

### Requirement 2: Table Schema

**User Story:** As a system, I need structured tables in NocoDB, so that Ko and I have a single source of truth.

#### Acceptance Criteria

1. THE System SHALL create a NocoDB project named "Workspace"
2. THE System SHALL create 5 tables: research, cron_jobs, projects, decisions, dashboards
3. THE research table SHALL have columns: id, title, content, status, created_at, updated_at, tags (Link field), source_url
4. THE cron_jobs table SHALL have columns: id, name, command, schedule, last_run, last_status, last_output, created_at
5. THE projects table SHALL have columns: id, name, description, status, created_at, updated_at
6. THE decisions table SHALL have columns: id, title, context, decision, rationale, created_at, tags (Link field)
7. THE dashboards table SHALL have columns: id, name, config (JSON/Text), created_at, updated_at, is_active
8. THE System SHALL set appropriate column types (text, date, multi-select, JSON)

### Requirement 3: REST API Integration

**User Story:** As an AI assistant, I need to write and query data via NocoDB's REST API, so that I can programmatically manage workspace data.

#### Acceptance Criteria

1. THE System SHALL obtain NocoDB API token from admin settings
2. THE System SHALL use NocoDB's REST API endpoints: /api/v2/tables/{table_id}/records
3. THE System SHALL create a Python wrapper script for common operations:
   * Create record (POST)
   * List records with filters (GET)
   * Update record (PATCH)
   * Delete record (DELETE)
4. THE System SHALL support filtering by status, tags, and text search
5. THE System SHALL handle authentication via API token header (xc-token)
6. THE System SHALL cache table IDs after first lookup
7. THE System SHALL log all API operations for debugging

### Requirement 4: Views and Dashboards

**User Story:** As Ko, I need to view and organize data using NocoDB's built-in views, so that I can see what the AI is working on without needing to ask.

#### Acceptance Criteria

1. Ko SHALL create table views using NocoDB's UI (grid views for all tables)
2. Ko SHALL create shared views for important tables (read-only links)
3. Ko SHALL create dashboards using NocoDB's dashboard feature
4. Ko SHALL add widgets to dashboards (stat cards, charts, grids)
5. Ko SHALL create filtered views (e.g., "Active Projects", "Failed Cron Jobs")
6. Ko SHALL enable sorting and grouping in views
7. Ko SHALL use NocoDB's form views if data entry is needed
8. NO CUSTOM UI OR COMPONENTS SHALL BE CREATED - use only NocoDB native features

---

## Design

### Architecture

```
┌─────────────────────────────────────────────────────────┐
│                    Tailscale Network                     │
└─────────────────────────────────────────────────────────┘
                           │
                    ┌──────▼──────┐
                    │  NocoDB     │
                    │  (Docker)   │
                    │  Port: 8080 │
                    └──────┬──────┘
                           │
                    ┌──────▼──────┐
                    │  SQLite     │
                    │  workspace  │
                    │  .db        │
                    └─────────────┘

Access Methods:
- Ko → NocoDB Web UI (via Tailscale) - view, create dashboards, filter
- AI → NocoDB REST API (via HTTP) - CRUD operations on tables
```

### Table Schema (NocoDB)

**research**

| Column | Type | Notes |
| -- | -- | -- |
| title | SingleLineText | Required |
| content | MultiLineText | Required |
| status | SingleSelect | Options: active, archived |
| created_at | Date | Default: now |
| updated_at | Date | Default: now |
| tags | MultiSelect | Tags for filtering |
| source_url | URL | Optional link |

**cron_jobs**

| Column | Type | Notes |
| -- | -- | -- |
| name | SingleLineText | Required, unique |
| command | MultiLineText | Required |
| schedule | SingleLineText | Cron expression |
| last_run | Date | Nullable |
| last_status | SingleSelect | Options: success, failed, never |
| last_output | MultiLineText | Output from last run |
| created_at | Date | Default: now |

**projects**

| Column | Type | Notes |
| -- | -- | -- |
| name | SingleLineText | Required, unique |
| description | MultiLineText |  |
| status | SingleSelect | Options: active, archived |
| created_at | Date | Default: now |
| updated_at | Date | Default: now |

**decisions**

| Column | Type | Notes |
| -- | -- | -- |
| title | SingleLineText | Required |
| context | MultiLineText | Background |
| decision | MultiLineText | Required |
| rationale | MultiLineText | Why this decision |
| created_at | Date | Default: now |
| tags | MultiSelect | Tags for filtering |

**dashboards**

| Column | Type | Notes |
| -- | -- | -- |
| name | SingleLineText | Required, unique |
| config | LongText | JSON configuration |
| created_at | Date | Default: now |
| updated_at | Date | Default: now |
| is_active | Checkbox | Boolean |

### Python API Wrapper

```python
# skills/nocodb-client/nocodb.py
import requests
import json

class NocoDBClient:
    def __init__(self, base_url, api_token):
        self.base_url = base_url
        self.api_token = api_token
        self.headers = {"xc-token": api_token}
        self.table_ids = {}  # Cache table name -> ID

    def get_table_id(self, table_name):
        """Get table ID by name, with caching."""
        if table_name not in self.table_ids:
            # Query NocoDB API to find table ID
            response = requests.get(
                f"{self.base_url}/api/v2/tables",
                headers=self.headers
            )
            tables = response.json()["list"]
            for table in tables:
                if table["title"] == table_name:
                    self.table_ids[table_name] = table["id"]
                    break
        return self.table_ids[table_name]

    def create_record(self, table_name, data):
        """Create a record in a table."""
        table_id = self.get_table_id(table_name)
        response = requests.post(
            f"{self.base_url}/api/v2/tables/{table_id}/records",
            headers=self.headers,
            json={"records": [data]}
        )
        return response.json()

    def list_records(self, table_name, filter=None, sort=None, limit=100):
        """List records with optional filters."""
        table_id = self.get_table_id(table_name)
        params = {"limit": limit}
        if filter:
            params["filter"] = json.dumps(filter)
        if sort:
            params["sort"] = json.dumps(sort)
        response = requests.get(
            f"{self.base_url}/api/v2/tables/{table_id}/records",
            headers=self.headers,
            params=params
        )
        return response.json()

    def update_record(self, table_name, record_id, data):
        """Update a record."""
        table_id = self.get_table_id(table_name)
        response = requests.patch(
            f"{self.base_url}/api/v2/tables/{table_id}/records",
            headers=self.headers,
            json={"records": [{"id": record_id, **data}]}
        )
        return response.json()

    def delete_record(self, table_name, record_id):
        """Delete a record."""
        table_id = self.get_table_id(table_name)
        response = requests.delete(
            f"{self.base_url}/api/v2/tables/{table_id}/records",
            headers=self.headers,
            params={"ids": [record_id]}
        )
        return response.json()
```

### Usage Examples

```python
from skills.nocodb_client.nocodb import NocoDBClient

nocodb = NocoDBClient(
    base_url="https://noco.tailnet.example.com",
    api_token="your-api-token"
)

# Create research record
nocodb.create_record("research", {
    "title": "Competitive Analysis",
    "content": "Analysis of competitor X features...",
    "status": "active",
    "tags": ["market-research"],
    "source_url": "https://example.com"
})

# List active projects
projects = nocodb.list_records(
    "projects",
    filter={"status": "active"}
)

# Update cron job status
nocodb.update_record("cron_jobs", job_id, {
    "last_status": "success",
    "last_run": datetime.now().isoformat()
})
```

---

## Tasks

- [ ] Task 1: Set up Tailscale server for NocoDB deployment
- [ ] Task 2: Create docker-compose.yml for NocoDB with SQLite
- [ ] Task 3: Deploy NocoDB and verify it's accessible via Tailscale
- [ ] Task 4: Create NocoDB admin account and set up initial project
- [ ] Task 5: Generate API token for programmatic access
- [ ] Task 6: Create 5 tables in NocoDB (research, cron_jobs, projects, decisions, dashboards)
- [ ] Task 7: Configure column types and default values for each table
- [ ] Task 8: Create Python NocoDB client wrapper script
- [ ] Task 9: Test API operations (create, read, update, delete)
- [ ] Task 10: Create sample data in all tables
- [ ] Task 11: Ko creates table views (grid views, filtered views)
- [ ] Task 12: Ko creates dashboards with widgets
- [ ] Task 13: Document setup process and API usage

---

## Tech Stack

* **NocoDB**: Open-source Airtable alternative
* **Database**: SQLite (NocoDB built-in)
* **Deployment**: Docker + Tailscale
* **API**: NocoDB REST API (v2)
* **Client**: Python requests library
* **UI**: NocoDB web interface (no custom frontend)

## Key Decisions

* Use NocoDB instead of custom FastAPI + React build - faster, less code, better UI
* SQLite database matches current setup, no migration needed
* Read-only for Ko is enforced at UI level (no edit forms needed if not desired)
* All dashboards and views created in NocoDB UI - no custom components
* API token authentication (simple, no complex auth setup)
