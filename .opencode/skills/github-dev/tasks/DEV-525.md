# DEV-525: [FEATURE]: NocoDB Evolution Tracking — Identity Change History + Session Handoff + Reflections

## Metadata
- **Identifier:** DEV-525
- **Priority:** High
- **State:** Open
- **Creator:** kokayi
- **Labels:** spec, kiro
- **Project:** suelo
- **Created:** 2026-02-08
- **Updated:** 2026-02-08
- **URL:** https://linear.app/consuelo/issue/DEV-525/feature-nocodb-evolution-tracking-identity-change-history-session
- **Linear ID:** f8074862-bf90-4d29-a2b5-6481e0e7e782

## Description

## Overview

**Problem Statement:** Right now the AI can only "evolve" by appending to [MEMORY.md](<http://MEMORY.md>). It cannot change its own core files ([SOUL.md](<http://SOUL.md>), [AGENTS.md](<http://AGENTS.md>), [ko.md](<http://ko.md>)) in a tracked, reviewable way. There is no history of how the AI's personality, operational rules, or pattern observations have changed over time — and no way to do 30-day reflections, measure growth, or understand what changed and why.

**Why This Matters:** This is the difference between an AI that remembers things and an AI that actually grows. Ko wants to look back in a month and see "oh wow, look how much you've changed." The core files ([SOUL.md](<http://SOUL.md>), [AGENTS.md](<http://AGENTS.md>), [ko.md](<http://ko.md>)) ARE the AI's identity — tracking changes to them is like tracking personal growth. Plus, session handoff (querying nocodb on wake-up instead of re-reading scattered files) makes every new session smarter from the first message.

**Current State:**

* Core files: [SOUL.md](<http://SOUL.md>), [AGENTS.md](<http://AGENTS.md>), [ko.md](<http://ko.md>), [IDENTITY.md](<http://IDENTITY.md>), [MEMORY.md](<http://MEMORY.md>), [people.md](<http://people.md>), [decisions.md](<http://decisions.md>)
* Files are edited in-place with no change history (git tracks some, but not queryable)
* No structured record of what changed, when, or why
* Session start requires reading 5+ files manually
* No reflection capability — can't compare "me today" vs "me 2 weeks ago"
* Memory is append-only ([MEMORY.md](<http://MEMORY.md>)) — no evolution of core behavior

**Desired State:** A NocoDB-backed system that tracks every meaningful change to core identity files, enables periodic reflection, and provides structured session handoff context so the AI wakes up smart.

---

## Requirements

### Requirement 1: Evolution Log Table

**User Story:** As Ko, I need to see how the AI's core identity has changed over time, so I can track growth and understand what's evolving.

#### Acceptance Criteria

1. THE System SHALL create an `evolution_log` table in the NocoDB Workspace project
2. THE evolution_log table SHALL have columns: id, file_changed (SingleSelect: [SOUL.md](<http://SOUL.md>), [AGENTS.md](<http://AGENTS.md>), [ko.md](<http://ko.md>), [IDENTITY.md](<http://IDENTITY.md>), [MEMORY.md](<http://MEMORY.md>)), change_type (SingleSelect: addition, modification, removal, restructure), section_changed (what part of the file), before_summary (brief description of old state), after_summary (brief description of new state), reason (why this change was made), created_at, session_id (which session triggered this)
3. THE AI SHALL write an evolution_log record every time it modifies [SOUL.md](<http://SOUL.md>), [AGENTS.md](<http://AGENTS.md>), [ko.md](<http://ko.md>), or [IDENTITY.md](<http://IDENTITY.md>)
4. THE AI SHALL NOT log routine [MEMORY.md](<http://MEMORY.md>) appends (only structural changes to [MEMORY.md](<http://MEMORY.md>))
5. THE System SHALL support querying evolution by file, by date range, and by change_type
6. Ko SHALL be able to view evolution in a timeline/grid sorted by created_at

### Requirement 2: Session Context Table

**User Story:** As an AI assistant, I need structured session handoff data, so that I wake up with full context without re-reading every file.

#### Acceptance Criteria

1. THE System SHALL create a `session_context` table in the NocoDB Workspace project
2. THE session_context table SHALL have columns: id, session_start (Date), session_end (Date), summary (what happened this session), key_decisions (decisions made), open_loops (things to follow up on), mood/energy (SingleSelect: focused, exploratory, debugging, strategic, casual), files_modified (list of files changed), created_at
3. THE AI SHALL write a session_context record at the end of each main session (not heartbeats or cron)
4. THE AI SHALL query the most recent 3 session_context records on startup to build context
5. THE AI SHALL surface any open_loops from previous sessions that haven't been addressed
6. THE System SHALL auto-archive sessions older than 30 days (mark as archived, don't delete)

### Requirement 3: Reflection System

**User Story:** As Ko, I want periodic reflections on how the AI has evolved, so I can see growth over time.

#### Acceptance Criteria

1. THE System SHALL create a `reflections` table in the NocoDB Workspace project
2. THE reflections table SHALL have columns: id, period (SingleSelect: weekly, monthly, quarterly), period_start (Date), period_end (Date), evolution_summary (how core files changed), patterns_learned (new patterns added to [ko.md](<http://ko.md>)), decisions_made (count + highlights), sessions_count, key_themes, growth_notes (AI's self-assessment of its own evolution), created_at
3. THE AI SHALL generate a weekly reflection every Sunday (via cron job)
4. THE AI SHALL generate a monthly reflection on the 1st of each month
5. THE reflection SHALL query evolution_log, session_context, and suggestions tables for the period
6. THE reflection SHALL compare current [SOUL.md/ko.md](<http://SOUL.md/ko.md>) against the versions from period_start
7. Ko SHALL be able to read reflections in NocoDB as a timeline of AI growth

### Requirement 4: Session Handoff Query

**User Story:** As an AI assistant waking up in a new session, I need a single query that gives me everything I need to be immediately useful.

#### Acceptance Criteria

1. THE System SHALL create a Python function `get_session_handoff()` in the NocoDB client
2. THE function SHALL return: last 3 session summaries, unresolved open_loops, unreviewed suggestions (from suggestions table), recent evolution_log entries (last 7 days), active projects (from projects table)
3. THE function SHALL format output as a structured context block ready to inject into session start
4. THE function SHALL complete in under 2 seconds (parallel API calls)
5. THE function SHALL gracefully degrade if any table query fails (return partial context)
6. THE AI SHALL call get_session_handoff() at the start of every main session

---

## Design

### New Tables

**evolution_log**

| Column | Type | Notes |
| -- | -- | -- |
| file_changed | SingleSelect | [SOUL.md](<http://SOUL.md>), [AGENTS.md](<http://AGENTS.md>), [ko.md](<http://ko.md>), [IDENTITY.md](<http://IDENTITY.md>), [MEMORY.md](<http://MEMORY.md>) |
| change_type | SingleSelect | addition, modification, removal, restructure |
| section_changed | SingleLineText | Which section of the file |
| before_summary | LongText | What it was before |
| after_summary | LongText | What it is now |
| reason | LongText | Why this change was made |
| created_at | Date | Default: now |
| session_id | SingleLineText | Session identifier |

**session_context**

| Column | Type | Notes |
| -- | -- | -- |
| session_start | Date | When session began |
| session_end | Date | When session ended |
| summary | LongText | What happened |
| key_decisions | LongText | Decisions made |
| open_loops | LongText | Things to follow up on |
| mood | SingleSelect | focused, exploratory, debugging, strategic, casual |
| files_modified | LongText | Comma-separated list |
| created_at | Date | Default: now |

**reflections**

| Column | Type | Notes |
| -- | -- | -- |
| period | SingleSelect | weekly, monthly, quarterly |
| period_start | Date | Start of reflection period |
| period_end | Date | End of reflection period |
| evolution_summary | LongText | How core files changed |
| patterns_learned | LongText | New [ko.md](<http://ko.md>) patterns |
| decisions_made | LongText | Count + highlights |
| sessions_count | Number | How many sessions |
| key_themes | LongText | Recurring topics |
| growth_notes | LongText | AI self-assessment |
| created_at | Date | Default: now |

### NocoDB Views (you creates these)

* **Evolution Log — Timeline**: Grid view, sorted by created_at desc
* **Evolution Log — By File**: Grouped by file_changed
* **Sessions — Recent**: Last 10 sessions, sorted by session_start desc
* **Sessions — Open Loops**: Filtered where open_loops is not empty
* **Reflections — All**: Grid view sorted by period_end desc

### Session Handoff Flow

```
New Session Starts
       |
       v
get_session_handoff()
       |
       +---> Query session_context (last 3)
       +---> Query suggestions (status = new)
       +---> Query evolution_log (last 7 days)
       +---> Query projects (status = active)
       +---> Query pulse_feed (unread, last 24h)
       |
       v
Structured Context Block
       |
       v
AI has full context from message #1
```

### Integration Points

```python
# At session end:
nocodb.create_record("session_context", {
    "session_start": "2026-02-08T10:00:00",
    "session_end": "2026-02-08T12:30:00",
    "summary": "Worked on nocodb specs, discussed evolution tracking",
    "key_decisions": "Keep file-based memory, mirror to nocodb, don't migrate yet",
    "open_loops": "Need to deploy nocodb, fix 6 broken cron jobs",
    "mood": "strategic",
    "files_modified": "none"
})

# When modifying a core file:
nocodb.create_record("evolution_log", {
    "file_changed": "ko.md",
    "change_type": "addition",
    "section_changed": "Observations Log",
    "before_summary": "No entry for Feb 8",
    "after_summary": "Added observation about nocodb as home base",
    "reason": "Noticed Ko's vision for persistent AI workspace",
    "session_id": "2026-02-08-main"
})
```

---

## Tasks

- [ ] Task 1: Create evolution_log table in NocoDB with all columns
- [ ] Task 2: Create session_context table in NocoDB with all columns
- [ ] Task 3: Create reflections table in NocoDB with all columns
- [ ] Task 4: Add get_session_handoff() function to NocoDB Python client
- [ ] Task 5: Add write_session_context() function (called at session end)
- [ ] Task 6: Add write_evolution_log() function (called when core files change)
- [ ] Task 7: Create weekly reflection cron job (Sundays in .openclaw folder)
- [ ] Task 8: Create monthly reflection cron job (1st of month to m .openclaw folder)
- [ ] Task 9: Wire session handoff into session startup flow
- [ ] Task 10: Create NocoDB views (evolution timeline, sessions recent, reflections)
- [ ] Task 11: Seed evolution_log with current state of all core files as baseline
- [ ] Task 12: Test full cycle: modify [ko.md](<http://ko.md>), verify evolution_log entry, verify next session handoff includes it

---

## Tech Stack

* **NocoDB**: Tables + views (from [DEV-509](https://linear.app/consuelo/issue/DEV-509/feature-deploy-nocodb-workspace-system-with-sqlite-and-tailscale) deployment)
* **Python**: session handoff, evolution logging
* **Cron**: Weekly/monthly reflection generation

## Dependencies

* [DEV-509](https://linear.app/consuelo/issue/DEV-509/feature-deploy-nocodb-workspace-system-with-sqlite-and-tailscale) (NocoDB deployment) must be completed first
* [DEV-524](https://linear.app/consuelo/issue/DEV-524/feature-nocodb-pulse-feed-chronological-cron-output-suggestions-inbox) (Pulse Feed) — session handoff queries pulse_feed table
